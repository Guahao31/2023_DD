# 移位寄存器

## 实验背景

### 移位寄存器

参考[移位寄存器-维基百科](https://zh.wikipedia.org/wiki/%E7%A7%BB%E4%BD%8D%E5%AF%84%E5%AD%98%E5%99%A8)。

**移位寄存器**(shift register)是一种在若干相同时钟脉冲下工作的以触发器级联为基础的器件，每个触发器的输出接在触发器链的下一级触发器的“数据”输入端，使得电路在每个时钟脉冲内依次向左或向右移动一个比特，并在输出端进行输出。

根据输入与输出特点，可有破坏性读出的串入串出、串入并出、并入串出等不同功能的移位寄存器。

**串入串出**，以 8 位右移移位寄存器为例，每次移位时，数据输入端移入最左边一位触发器的输出中，同时最右边一位触发器的输出移出并丢失。破坏性读出的含义是所有数据在被移位到最右边的位后就会丢失。

**串入并出**，可以将输入的串行数据以并行格式输出。在串行通信要求的几位数据完成输入后就可以在输出端的各位同时读出并行数据。

<img src="../pic/4-Bit_SIPO_Shift_Register.png">

**并入串出**，可以接收外部并行数据，以最高级位触发器输出作为串行输出位，使用一位控制信号来选择并行读入或串行输出。在写/移位控制线保持低电平时，将并行输入的数据写入寄存器中；在写/移位控制线保持高电平时，进行移位。

<img src="../pic/4-Bit_PISO_Shift_Register.png">

本实验要求的右移移位寄存器功能为：能够并行输入与串行输入功能，使用一个控制信号选择并行输入或串入并出。串行/并行输入信号 $\overline{Shift}/Load$ 为低位时进行串入串出，在每个时钟上升沿进行右移同时将串行输入的 `shift_in` 信号移入最左边的触发器中；串行/并行输入信号为高位时进行并行写入，将并行输入端口数据 `par_in` 写入触发器中。

<img src="../pic/p_load_shift_reg.png" style="zoom: 90%">

### 74LV164A 芯片功能

仅作了解即可，本节内容参考 [datasheet](https://www.ti.com/lit/ds/symlink/sn74lv164a.pdf)。

74LV164A 功能为 8 位串入并出移位寄存器。清零端 `CLR` 低电平有效，异步重置将触发器的值修改为 `0`；串入数据端 `A, B` 均为高位时输入 `1`，其他输入下表示输入 `0`。使用的触发器为正边沿触发。

<img src="../pic/74LV164A_diagram.png">

74LS164 芯片功能与 74LV164A 基本相同，使用的技术不同导致电气特性不同，我们不需要关注。

### 主板 LED 与七段数码管

SWORD 板上 LED 与七段数码管均是由若干个 74LV164A 构成的**串转并**（串行输入、并行输出）模块控制，可以回想在使用板上 LED 与七段数码管时，我们会约束 `s_out, s_clk, s_clr` 等信号，这其实就是串转并模块需要的串行通信信号。

以 LED 为例，板上共 16 个 LED，需要 16 位信号进行控制，可以使用两个 74LV164A 组成 16 位右移移位寄存器来控制，在使用时，我们需要对 `LED_CLK, LED_DO` 等信号进行控制，在 `LED_CLK` 上升沿会发生移位并将 `LED_DO` 信号的值传入寄存器最低位。

<img src="../pic/LED_diagram.png">

## 移位寄存器的实现

使用 Verilog 代码完成一个